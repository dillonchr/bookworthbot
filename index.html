<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,user-scalable=0,initial-scale=1">
    <title>Bookworth</title>
</head>
<body>
<form>
    <input id="title" placeholder="Title">
    <input id="author" placeholder="Author">
    <input id="publisher" placeholder="Publisher">
    <button id="go">GO</button>
</form>
<h1></h1>
<p>Total Average: <span id="avg"></span></p>
<p>ABE: <span id="abe"></span></p>
<p>ebay Sold: <span id="sold"></span></p>
<p>ebay Live: <span id="ebay"></span></p>
<p>etsy: <span id="etsy"></span></p>
<p>Confidence: <span id="conf"></span></p>
<script>
    function getVal(id) {
        return encodeURIComponent(document.getElementById(id).value);
    }

    function getSearchUrl() {
        return '/?title=' + getVal('title') + '&author=' + getVal('author') + '&publisher=' + getVal('publisher');
    }

    function runSearch() {
        fetch(getSearchUrl())
            .then(function(r) {
                return r.json();
            })
            .then(function(results) {
                var shouldBuy = results[0];
                var abe = results[1];
                var ebaySold = results[2];
                var ebayLive = results[3];
                var etsy = results[4];
                var avg = results[5];
                var conf = results[6];
                document.querySelector('h1').innerText = shouldBuy > 1 ? 'YES' : shouldBuy === 0 ? 'NO' : 'MAYBE';
                document.getElementById('avg').innerText = avg.toFixed(2);
                document.getElementById('abe').innerText = abe.toFixed(2);
                document.getElementById('sold').innerText = ebaySold.toFixed(2);
                document.getElementById('ebay').innerText = ebayLive.toFixed(2);
                document.getElementById('etsy').innerText = etsy.toFixed(2);
                document.getElementById('conf').innerText = conf.toFixed(2) + '%';
            });
    }

    document.querySelector('form').addEventListener('submit', function(e) {
        e.preventDefault();
        runSearch();
        return false;
    });
</script>
</body>
</html>